<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bayesian linear model • blm</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Bayesian linear model">
<meta property="og:description" content="The R package blm can be used to perform Bayesian
  linear regression with informative priors. It uses a Gibbs 
  sampler implemented in Julia.">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">blm</a>
        <span class="label label-danger" data-toggle="tooltip" data-placement="bottom" title="Unreleased package">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/JasperHG90/blm">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="contents col-md-9">
    <div id="bayesian-linear-model-blm" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#bayesian-linear-model-blm" class="anchor"></a>Bayesian Linear Model (<code>blm</code>)</h1></div>
<p>I created this R library to implement some core Bayesian ideas taught in the course “Introduction to Bayesian Statitics” at Utrecht University. Secondly, it also provided me with an opportunity to further practice <a href="https://julialang.org/">Julia</a>. Julia code is fast, but needs to compile on the first run. Hence, the highly repetitive nature of the code for Bayesian estimation (small functions that are repeatedly used) makes Julia an ideal programming language to run Markov Chain Monte Carlo (MCMC) samplers.</p>
<p>Thanks to the R library <a href="https://github.com/Non-Contradiction/JuliaCall">JuliaCall</a>, it is possible to create a near-seamless bridge between R code and Julia code (much like the <a href="https://rstudio.github.io/reticulate/">Reticulate</a> library does for Python). This bridge is used as follows:</p>
<ol>
<li>All model-building aspects are constructed in R. Users specify a model much like they would with the <code>lm()</code> function. blm imports the <a href="https://magrittr.tidyverse.org/">magrittr</a> library to facilitate model building, and allows the user to build a model using a ‘tidy’ workflow. The functions associated with this part of the model begin with <code>set_</code> (e.g. <code>set_priors()</code>). The exception here is the function <code><a href="reference/compute_null_model.html">compute_null_model()</a></code>, which (if added) computes the intercept-only model during evaluation.</li>
<li>After the model is specified by the user, the sampling plan is executed (much like the <code>collect()</code> command from the <a href="https://github.com/tidyverse/dbplyr">dbplyr</a> library). This part calls the Julia code to draw posterior samples. The functions associated with this part of the model end with <code>_posterior</code> (e.g. <code><a href="reference/sample_posterior.html">sample_posterior()</a></code>, <code><a href="reference/update_posterior.html">update_posterior()</a></code>, <code><a href="reference/delete_posterior.html">delete_posterior()</a></code>).</li>
<li>Once the posterior distribution is sampled, all plotting functionality and summary statistics of the posterior is executed in R. If additional samples or computations need to be carried out (e.g. posterior predictive checks or DIC), these are executed in Julia. The functions associated with this part start with <code>evaluate_</code> (e.g. <code><a href="reference/evaluate_model_fit.html">evaluate_model_fit()</a></code>).</li>
</ol>
<p>All core functions return S3 objects. Data embedded in these objects can be retrieved using the <code><a href="reference/get_value.html">get_value()</a></code> function. To check whether an object contains a specific value, you can execute <code><a href="reference/contains.html">contains()</a></code>.</p>
<p>The following documents contain specific information or implementation notes:</p>
<ul>
<li><a href="https://github.com/JasperHG90/blm/blob/master/notes/3.%20Course%20summary/course_summary.pdf">Course summary</a></li>
<li><a href="https://github.com/JasperHG90/blm/blob/master/notes/1.%20Implementation%20notes%20Gibbs/conditionalposterior.pdf">Implementation notes Gibbs sampler</a></li>
<li><a href="https://github.com/JasperHG90/blm/blob/master/notes/2.%20Implementation%20notes%20MH/MH.pdf">Implementation notes Metropolis-Hastings sampler</a></li>
<li><a href="https://github.com/JasperHG90/blm/blob/master/notes/6.%20Linear%20Mixed%20Effects%20in%20JAGS/multiJags.pdf">Multilevel analysis of Directors data using JAGS</a></li>
<li><a href="https://github.com/JasperHG90/blm/blob/master/notes/7.%20Bayes%20Factors/BF.pdf">Bayes Factors</a></li>
</ul>
<div id="folder-structure" class="section level2">
<h2 class="hasAnchor">
<a href="#folder-structure" class="anchor"></a>Folder structure</h2>
<p>The folder structure is described below. Important files are annotated.</p>
<div class="sourceCode"><pre class="sourceCode R"><code class="sourceCode r">├── data                                        <span class="co"># Contains data used in the package</span>
│   └── directors.rda              
├── data<span class="op">-</span>raw                                    <span class="co"># R script used to create 'directors.rda'</span>
│   └── preprocess_directors_data.R  
├── notes                                       <span class="co"># Implementation notes, course summary and final assignment</span>
│   ├── <span class="fl">1.</span> Implementation notes Gibbs    
│       ├── conditionalposteriors.pdf           <span class="co">#  - Implementation notes for Gibbs sampler</span>
│       └── ...
│   ├── <span class="fl">2.</span> Implementation notes MH 
│       ├── MH.pdf                              <span class="co">#  - Implementation notes for Metropolis-Hastings sampler</span>
│       └── ...
│   ├── <span class="fl">3.</span> Course summary
│       ├── course_summary.pdf                  <span class="co">#  - Course summary</span>
│       └── ...
│   ├── <span class="fl">4.</span> Final Assigment
│       ├── final_assignment.pdf                <span class="co">#  - Final assignment for the course</span>
│       └── ...
│   ├── <span class="fl">5.</span> blm example
│       ├── blm.pdf                             <span class="co">#  - Short example of blm code</span>
│       └── ...
│   ├── <span class="fl">6.</span> Linear Mixed Effects JAGS
│       ├── multilevel_jags.pdf                 <span class="co">#  - multilevel analysis of the directors dataset using JAGS</span>
│       └── ... 
│   ├── <span class="fl">7.</span> Bayes Factors
│       ├── BF.pdf                              <span class="co">#  - Some background and references on Informative Hypotheses and Bayes Factors</span>
│       └── ... 
├── docs                                        <span class="co"># pkgdown documents</span>
│   └── ...
├── experiments                                 <span class="co"># Various files used to test out new features / run simulations</span>
│   └── ...
├── img                                         <span class="co"># Images used by the README</span>
│   └── ...
├── inst
│   └── julia
│       └── blm.jl                              <span class="co"># Julia script containing core blm functions.</span>
├── man                                         <span class="co"># Documentation for R functions used by the library</span>
│   └── ...
├── R
│   ├── blm_julia_setup.R                       <span class="co"># Logic to build a bridge between R / Julia               </span>
│   ├── classes.R                               <span class="co"># core S3 classes used by blm library          </span>
│   ├── data.R                                  <span class="co"># Documentation for the 'directors' data</span>
│   ├── generics.R                              <span class="co"># S3 generics for all methods defined in blm</span>
│   ├── ggplot_theme.R                          <span class="co"># ggplot2 theme used by blm plotting function</span>
│   ├── helpers.R                               <span class="co"># utility functions </span>
│   ├── input_checks.R                          <span class="co"># helper functions that check whether inputs to key functions are valid</span>
│   ├── methods_blm.R                           <span class="co"># S3 methods for core class 'blm' </span>
│   ├── methods_hypotheses.R                    <span class="co"># S3 methods for classes 'hypotheses' and 'hypothesis' </span>
│   ├── methods_misc.R                          <span class="co"># S3 methods for minor classes 'R2' and 'DIC'</span>
│   ├── methods_posterior.R                     <span class="co"># S3 methods for class 'posterior'</span>
│   ├── methods_ppc.R                           <span class="co"># S3 methods for class 'ppc'</span>
│   ├── methods_prior.R                         <span class="co"># S3 methods for classes 'prior' and 'priors'</span>
│   ├── methods_sampler.R                       <span class="co"># S3 methods for class 'sampler'</span>
│   ├── methods_shared.R                        <span class="co"># S3 methods that are shared by classes</span>
│   └── zzz.R                                   <span class="co"># Contains start-up logic when package is loaded by user</span>
├── tests
│   └── ...                                     <span class="co"># Unit tests</span>
├── vignettes
│   └── ...                                     <span class="co"># Package vignettes</span>
├── LICENSE
├── .gitignore
├── .Rbuildignore
├── .travis.yml
├── .blm.Rproj
├── .DESCRIPTION
├── NAMESPACE
└── README.md</code></pre></div>
</div>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p>Installing the R library from GitHub is straightforward</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">devtools<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/devtools/topics/install_github">install_github</a></span>(<span class="st">"JasperHG90/blm"</span>)</code></pre></div>
<p>R dependencies will be installed automatically. You will also need an installation of Julia (&gt;= 1.0.0, in practice either the long-term stable release or the current stable version), which you can install from <a href="https://julialang.org/downloads/">here</a>.</p>
<div id="aside-installing-julia-on-windows" class="section level3">
<h3 class="hasAnchor">
<a href="#aside-installing-julia-on-windows" class="anchor"></a>Aside: installing Julia on Windows</h3>
<p>On Windows, follow the following steps.</p>
<ol>
<li>When installing Julia, take note of your installation path</li>
</ol>
<p><img src="img/1recordpath.png" width="500px"></p>
<ol>
<li>Search for ‘path’ in the windows search path and select ‘edit the system environment variables’</li>
</ol>
<p><img src="img/2findpathvars.png" width="500px"></p>
<ol>
<li>Click on ‘environment variables’</li>
</ol>
<p><img src="img/3chooseenv.png" width="500px"></p>
<p>4, Select the ‘path’ variable under ‘user variables for <yourusername>’ and click ‘edit’</yourusername></p>
<p><img src="img/4editpath.png" width="500px"></p>
<ol>
<li>Click on ‘new’ and paste the path you copied at step one, followed by ‘\bin’. Then click ‘OK’.</li>
</ol>
<p><img src="img/5addpath.png" width="500px"></p>
<ol>
<li>Restart RStudio.</li>
</ol>
</div>
</div>
<div id="setting-up-r-julia" class="section level2">
<h2 class="hasAnchor">
<a href="#setting-up-r-julia" class="anchor"></a>Setting up R &amp; Julia</h2>
<p>To test whether R can find the Julia installation, execute the following in R:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(blm)
<span class="co"># Create the bridge between R and Julia</span>
<span class="kw"><a href="reference/blm_setup.html">blm_setup</a></span>()</code></pre></div>
<p>If this succeeds, you should see something akin to the following message:</p>
<pre class="shell"><code>Julia version 1.0.3 at location /home/jasper/julia-1.0.3/bin will be used.
Loading setup script for JuliaCall...
Finish loading setup script for JuliaCall.</code></pre>
<p>This means you are good to go.</p>
</div>
<div id="short-example" class="section level2">
<h2 class="hasAnchor">
<a href="#short-example" class="anchor"></a>Short example</h2>
<p>To build a Bayesian Linear Model (blm) object, start by executing the following:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Load data</span>
<span class="kw">data</span>(<span class="st">"directors"</span>)
<span class="co"># Log the compensation variable ('000 GBR)</span>
directors<span class="op">$</span>Compensation &lt;-<span class="st"> </span><span class="kw">log</span>(directors<span class="op">$</span>Compensation)
<span class="co"># Build the model</span>
dirfit &lt;-<span class="st"> </span><span class="kw"><a href="reference/blm.html">blm</a></span>(<span class="st">"Compensation ~ Age"</span>, <span class="dt">data=</span>directors)</code></pre></div>
<p>This creates a blm object for the ‘directors’ data. At this point, we have a model with uninformative priors (mu=0, sd=1000) and initial values that are drawn from these priors:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">print</span>(dirfit)</code></pre></div>
<pre class="shell"><code>Bayesian Linear Model (BLM) object:

Data:
    Predictors: 1
    Outcome: Compensation

Sampler:
    Chains: 1
    Iterations: 10000
    Thinning: 1
    Burn: 1000

Priors (Coefficients) :
      b0   b1
mu     0    0
tau 1000 1000

Priors (Residuals) :
      sigma
rate   0.01
scale  0.01</code></pre>
<p>Furthermore, the sampling settings are set to just $1$ chain and $10.000$ iterations. We can update the model as follows:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Set the following values for the dirfit model</span>
dirfit &lt;-<span class="st"> </span>dirfit <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># Sampling settings</span>
<span class="st">  </span><span class="kw"><a href="reference/set_sampling_options.html">set_sampling_options</a></span>(<span class="dt">chains=</span><span class="dv">2</span>, <span class="dt">iterations=</span><span class="dv">20000</span>, <span class="dt">burn=</span><span class="dv">3000</span>, <span class="dt">thinning=</span><span class="dv">2</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># Set priors for Age (we're on a log scale)</span>
<span class="st">  </span><span class="kw"><a href="reference/set_prior.html">set_prior</a></span>(<span class="st">"b1"</span>, <span class="dt">mu=</span><span class="fl">0.2</span>, <span class="dt">sd =</span> <span class="fl">0.001</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="co"># Set initial values</span>
<span class="st">  </span><span class="kw"><a href="reference/set_initial_values.html">set_initial_values</a></span>(<span class="dt">chain_1 =</span> <span class="kw">list</span>(<span class="st">"b"</span> =<span class="st"> </span><span class="kw">c</span>(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>), <span class="st">"sigma"</span> =<span class="st"> </span><span class="dv">1</span>),
                     <span class="dt">chain_2 =</span> <span class="kw">list</span>(<span class="st">"b"</span> =<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">-1</span>), <span class="st">"sigma"</span> =<span class="st"> </span><span class="dv">2</span>))
<span class="co"># Print object</span>
<span class="kw">print</span>(dirfit)</code></pre></div>
<pre class="shell"><code>Bayesian Linear Model (BLM) object:

Data:
    Predictors: 1
    Outcome: Compensation

Sampler:
    Chains: 2
    Iterations: 20000
    Thinning: 2
    Burn: 3000

Priors (Coefficients) :
      b0    b1
mu     0 0.200
tau 1000 0.001

Priors (Residuals) :
      sigma
rate   0.01
scale  0.01</code></pre>
<p>View the full example here [LINK].</p>
</div>
<div id="references" class="section level2">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<p>I used the following materials in building this library</p>
<ul>
<li><p>All course materials @ Utrecht University Bayesian statistics, taught by Herman Hoijtink &amp; Fayette Klaassen.</p></li>
<li><p>Gabry, J., Simpson, D., Vehtari, A., Betancourt, M., &amp; Gelman, A. (2019). Visualization in Bayesian workflow. Journal of the Royal Statistical Society: Series A (Statistics in Society), 182(2), 389-402.</p></li>
<li><p>Schad, D. J., Betancourt, M., &amp; Vasishth, S. (2019). Toward a principled Bayesian workflow in cognitive science. arXiv preprint arXiv:1904.12765.</p></li>
<li><p>Gelman, A., Goodrich, B., Gabry, J., &amp; Vehtari, A. (2018). R-squared for Bayesian regression models. The American Statistician, (just-accepted), 1-6.</p></li>
<li><p>Nakagawa, S., &amp; Schielzeth, H. (2013). A general and simple method for obtaining R2 from generalized linear mixed‐effects models. Methods in Ecology and Evolution, 4(2), 133-142.</p></li>
<li><p>Aarts, E. (2019). Introduction to multilevel analysis and the basic two-level regression model, week 1 notes [powerpoint presentation]. -Introduction to Multilevel Analysis-, Utrecht University.</p></li>
<li><p>Lynch, S. M. (2007). Introduction to applied Bayesian statistics and estimation for social scientists. Springer Science &amp; Business Media.</p></li>
<li><p>Gelman, A., Stern, H. S., Carlin, J. B., Dunson, D. B., Vehtari, A., &amp; Rubin, D. B. (2013). Bayesian data analysis. Chapman and Hall/CRC.</p></li>
<li><p>Kruschke, J. (2014). Doing Bayesian data analysis: A tutorial with R, JAGS, and Stan. Academic Press.</p></li>
<li><p>Hox, J. J., Moerbeek, M., &amp; Van de Schoot, R. (2017). Multilevel analysis: Techniques and applications. Routledge.</p></li>
<li><p>Robert, C. P., Casella, G., &amp; Casella, G. (2010). Introducing monte carlo methods with r (Vol. 18). New York: Springer.</p></li>
<li><p>Hoijtink, H., Mulder, J., Van Lissa, C. J., &amp; Gu, X. (2019). A tutorial on testing hypotheses using the Bayes factor.</p></li>
<li><p>Hoijtink, H., Gu, X., &amp; Mulder, J. (2018). Bayesian evaluation of informative hypotheses for multiple populations. British Journal of Mathematical and Statistical Psychology.</p></li>
<li><p>Gu, X., Mulder, J., &amp; Hoijtink, H. (2018). Approximated adjusted fractional Bayes factors: A general method for testing informative hypotheses. British Journal of Mathematical and Statistical Psychology, 71(2), 229-261.</p></li>
<li><p>Gu, X., Hoijtink, H., &amp; Mulder, J. (2016). Error probabilities in default Bayesian hypothesis testing. Journal of Mathematical Psychology, 72, 130-143.</p></li>
<li><p>Lambert, B. [Ben Lambert]. (2018, May 17). <em>Introducing Bayes Factors and Marginal Likelihoods</em>. Retrieved from <a href="https://www.youtube.com/watch?v=T-kMpA4z-7k" class="uri">https://www.youtube.com/watch?v=T-kMpA4z-7k</a></p></li>
<li><p>Morey, R. (2014, February 9). <em>What is a Bayes Factor?</em>. [Blog Post]. Retrieved from <a href="https://bayesfactor.blogspot.com/2014/02/the-bayesfactor-package-this-blog-is.html" class="uri">https://bayesfactor.blogspot.com/2014/02/the-bayesfactor-package-this-blog-is.html</a></p></li>
</ul>
</div>
</div>
  </div>

  <div class="col-md-3" id="sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>Download from CRAN at <br><a href="https://cloud.r-project.org/package=blm">https://​cloud.r-project.org/​package=blm</a>
</li>
<li>Browse source code at <br><a href="https://github.com/JasperHG90/blm">https://​github.com/​JasperHG90/​blm</a>
</li>
<li>Report a bug at <br><a href="https://github.com/JasperHG90/blm/issues">https://​github.com/​JasperHG90/​blm/​issues</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="https://opensource.org/licenses/mit-license.php">MIT</a></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>Jasper Ginn <br><small class="roles"> Author, maintainer </small>  </li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p>Developed by Jasper Ginn.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
